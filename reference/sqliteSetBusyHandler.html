<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Configure what SQLite should do when the database is locked — sqliteSetBusyHandler • RSQLite</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Configure what SQLite should do when the database is locked — sqliteSetBusyHandler"><meta name="description" content="When a transaction cannot lock the database, because it is already
locked by another one, SQLite by default throws an error:
database is locked. This behavior is usually not appropriate when
concurrent access is needed, typically when multiple processes write to
the same database.
sqliteSetBusyHandler() lets you set a timeout or a handler for these
events. When setting a timeout, SQLite will try the transaction multiple
times within this timeout. To set a timeout, pass an integer scalar to
sqliteSetBusyHandler().
Another way to set a timeout is to use a PRAGMA, e.g. the SQL query
PRAGMA busy_timeout=3000

sets the busy timeout to three seconds."><meta property="og:description" content="When a transaction cannot lock the database, because it is already
locked by another one, SQLite by default throws an error:
database is locked. This behavior is usually not appropriate when
concurrent access is needed, typically when multiple processes write to
the same database.
sqliteSetBusyHandler() lets you set a timeout or a handler for these
events. When setting a timeout, SQLite will try the transaction multiple
times within this timeout. To set a timeout, pass an integer scalar to
sqliteSetBusyHandler().
Another way to set a timeout is to use a PRAGMA, e.g. the SQL query
PRAGMA busy_timeout=3000

sets the busy timeout to three seconds."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RSQLite</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/RSQLite.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-dbi/RSQLite/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Configure what SQLite should do when the database is locked</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-dbi/RSQLite/blob/main/R/SQLiteConnection.R" class="external-link"><code>R/SQLiteConnection.R</code></a></small>
      <div class="d-none name"><code>sqliteSetBusyHandler.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When a transaction cannot lock the database, because it is already
locked by another one, SQLite by default throws an error:
<code>database is locked</code>. This behavior is usually not appropriate when
concurrent access is needed, typically when multiple processes write to
the same database.</p>
<p><code>sqliteSetBusyHandler()</code> lets you set a timeout or a handler for these
events. When setting a timeout, SQLite will try the transaction multiple
times within this timeout. To set a timeout, pass an integer scalar to
<code>sqliteSetBusyHandler()</code>.</p>
<p>Another way to set a timeout is to use a <code>PRAGMA</code>, e.g. the SQL query</p>
<p></p><div class="sourceCode sql"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>PRAGMA busy_timeout<span class="op">=</span><span class="dv">3000</span></span></code></pre><p></p></div>
<p>sets the busy timeout to three seconds.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sqliteSetBusyHandler</span><span class="op">(</span><span class="va">dbObj</span>, <span class="va">handler</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dbobj">dbObj<a class="anchor" aria-label="anchor" href="#arg-dbobj"></a></dt>
<dd><p>A <a href="SQLiteConnection-class.html">SQLiteConnection</a> object.</p></dd>


<dt id="arg-handler">handler<a class="anchor" aria-label="anchor" href="#arg-handler"></a></dt>
<dd><p>Specifies what to do when the database is locked by
another transaction. It can be:</p><ul><li><p><code>NULL</code>: fail immediately,</p></li>
<li><p>an integer scalar: this is a timeout in milliseconds that corresponds
to <code>PRAGMA busy_timeout</code>,</p></li>
<li><p>an R function: this function is called with one argument, see details
below.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisible <code>NULL</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that SQLite currently does <em>not</em> schedule concurrent transactions
fairly. If multiple transactions are waiting on the same database,
any one of them can be granted access next. Moreover, SQLite does not
currently ensure that access is granted as soon as the database is
available. Make sure that you set the busy timeout to a high enough
value for applications with high concurrency and many writes.</p>
<p>If the <code>handler</code> argument is a function, then it is used as a callback
function. When the database is locked, this will be called with a single
integer, which is the number of calls for same locking event. The
callback function must return an integer scalar. If it returns <code>0L</code>,
then no additional attempts are made to access the database, and
an error is thrown. Otherwise another attempt is made to access the
database and the cycle repeats.</p>
<p>Handler callbacks are useful for debugging concurrent behavior, or to
implement a more sophisticated busy algorithm. The latter is currently
considered experimental in RSQLite. If the callback function fails, then
RSQLite will print a warning, and the transaction is aborted with a
"database is locked" error.</p>
<p>Note that every database connection has its own busy timeout or handler
function.</p>
<p>Calling <code>sqliteSetBusyHandler()</code> on a connection that is not connected
is an error.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://www.sqlite.org/c3ref/busy_handler.html" class="external-link">https://www.sqlite.org/c3ref/busy_handler.html</a></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, David A. James, Seth Falcon, R Consortium.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

